<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Introduction to icd • icd</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Quick Introduction to icd">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">icd</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">3.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Charlson_and_other_scores.html">Charlson and Van Walraven scores</a>
    </li>
    <li>
      <a href="../articles/Comparing_Comorbidity_Mappings_Vignette.html">Comparing Comorbidity Mappings</a>
    </li>
    <li>
      <a href="../articles/Efficient_calculation_of_comorbidities_from_medical_codes.pdf">icd: Efficient Computation of Comorbidities from ICD Codes Using Sparse Matrix Multiplication in R (PDF)</a>
    </li>
    <li>
      <a href="../articles/Ranges.html">Ranges of ICD codes</a>
    </li>
    <li>
      <a href="../articles/Using_Hierarchical_Condition_Codes.html">Using Hierarchical Condition Codes</a>
    </li>
    <li>
      <a href="../articles/icd-10.html">ICD-10 comorbidities</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Quick Introduction to icd</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Quick Introduction to icd</h1>
                        <h4 class="author">Jack O. Wasey</h4>
            
            <h4 class="date">8 May, 2018</h4>
      
      
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<!--
Copyright (C) 2014 - 2018  Jack O. Wasey

This file is part of icd.

icd is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

icd is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with icd. If not, see <http:#www.gnu.org/licenses/>.
-->
<div id="quick-start" class="section level2">
<h2 class="hasAnchor">
<a href="#quick-start" class="anchor"></a>Quick Start</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(uranium_pathology, <span class="dv">10</span>)
<span class="co">#&gt;    case icd10</span>
<span class="co">#&gt; 1     1 F17.9</span>
<span class="co">#&gt; 2     1 I21.9</span>
<span class="co">#&gt; 3     1 K75.9</span>
<span class="co">#&gt; 4     1   R55</span>
<span class="co">#&gt; 5     2 I25.1</span>
<span class="co">#&gt; 6     2 I35.8</span>
<span class="co">#&gt; 7     2 I63.9</span>
<span class="co">#&gt; 8     2   I64</span>
<span class="co">#&gt; 9     2 J43.9</span>
<span class="co">#&gt; 10    2 J84.1</span>
<span class="kw">head</span>(<span class="kw"><a href="../reference/comorbid.html">comorbid_charlson</a></span>(uranium_pathology))
<span class="co">#&gt;      MI   CHF   PVD Stroke Dementia Pulmonary Rheumatic   PUD LiverMild</span>
<span class="co">#&gt; 1  TRUE FALSE FALSE  FALSE    FALSE     FALSE     FALSE FALSE     FALSE</span>
<span class="co">#&gt; 2 FALSE FALSE FALSE   TRUE    FALSE      TRUE     FALSE FALSE     FALSE</span>
<span class="co">#&gt; 3  TRUE FALSE FALSE  FALSE    FALSE     FALSE     FALSE FALSE     FALSE</span>
<span class="co">#&gt; 4 FALSE FALSE FALSE  FALSE    FALSE     FALSE     FALSE FALSE     FALSE</span>
<span class="co">#&gt; 5 FALSE FALSE FALSE  FALSE    FALSE     FALSE     FALSE FALSE     FALSE</span>
<span class="co">#&gt; 6  TRUE FALSE  TRUE  FALSE    FALSE      TRUE     FALSE FALSE     FALSE</span>
<span class="co">#&gt;      DM  DMcx Paralysis Renal Cancer LiverSevere  Mets   HIV</span>
<span class="co">#&gt; 1 FALSE FALSE     FALSE FALSE  FALSE       FALSE FALSE FALSE</span>
<span class="co">#&gt; 2 FALSE FALSE     FALSE FALSE  FALSE       FALSE FALSE FALSE</span>
<span class="co">#&gt; 3 FALSE FALSE     FALSE FALSE  FALSE       FALSE FALSE FALSE</span>
<span class="co">#&gt; 4 FALSE FALSE     FALSE FALSE  FALSE       FALSE FALSE FALSE</span>
<span class="co">#&gt; 5 FALSE FALSE     FALSE FALSE  FALSE       FALSE  TRUE FALSE</span>
<span class="co">#&gt; 6 FALSE FALSE     FALSE FALSE  FALSE       FALSE FALSE FALSE</span>
<span class="kw"><a href="../reference/comorbid.html">comorbid_charlson</a></span>(uranium_pathology, <span class="dt">return_df =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt;   case    MI   CHF   PVD Stroke</span>
<span class="co">#&gt; 1    1  TRUE FALSE FALSE  FALSE</span>
<span class="co">#&gt; 2    2 FALSE FALSE FALSE   TRUE</span>
<span class="co">#&gt; 3    3  TRUE FALSE FALSE  FALSE</span>
<span class="co">#&gt; 4    4 FALSE FALSE FALSE  FALSE</span>
<span class="co">#&gt; 5    5 FALSE FALSE FALSE  FALSE</span>
<span class="kw">hist</span>(<span class="kw"><a href="../reference/charlson.html">charlson</a></span>(uranium_pathology))</code></pre></div>
<p><img src="introduction_files/figure-html/quickstart-1.png" width="700"></p>
</div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Calculate comorbidities, Charlson scores, perform fast and accurate validation, conversion, manipulation, filtering and comparison of ICD-9 and ICD-10 codes. This package enables a work flow from raw lists of ICD codes in hospital databases to comorbidities. ICD-9 and ICD-10 comorbidity mappings from Quan (Deyo and Elixhauser versions), Elixhauser and AHRQ included. Common ambiguities and code formats are handled.</p>
<p>When calculating which patients have which comorbidities, the data are typically structured in long or wide formats:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># long format ICD-9-CM codes, with present-on-arrival flags</span>
patients_icd9
<span class="co">#&gt;   visit_id  icd9  poa</span>
<span class="co">#&gt; 1     1000 40201    Y</span>
<span class="co">#&gt; 2     1000  2258 &lt;NA&gt;</span>
<span class="co">#&gt; 3     1000  7208    N</span>
<span class="co">#&gt; 4     1000 25001    Y</span>
<span class="co">#&gt; 5     1001 34400    X</span>
<span class="co">#&gt; 6     1001  4011    Y</span>
<span class="co">#&gt; 7     1002  4011    E</span>

<span class="co"># long format ICD-10 codes, real mortality data</span>
uranium_pathology[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ]
<span class="co">#&gt;   case icd10</span>
<span class="co">#&gt; 1    1 F17.9</span>
<span class="co">#&gt; 2    1 I21.9</span>
<span class="co">#&gt; 3    1 K75.9</span>
<span class="co">#&gt; 4    1   R55</span>
<span class="co">#&gt; 5    2 I25.1</span>

<span class="co"># wide format, real ICD-9 discharge diagnoses</span>
vermont_dx[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">15</span>)]
<span class="co">#&gt;   visit_id   DX1   DX2   DX3   DX4   DX5   DX6   DX7   DX8   DX9  DX10</span>
<span class="co">#&gt; 1        7 27801 03842 51881 41519 99591 42842  5849  5609  6826  5853</span>
<span class="co">#&gt; 2       10 71526 25000 42830  4280  4019  4241   311 49390  2724 73300</span>
<span class="co">#&gt; 3       13 71535 59651 78052 27800 V8537   311  4019 53081 56400      </span>
<span class="co">#&gt; 4       16 71535 49390 53081 27800  V140  V141  V142  V160 V8538      </span>
<span class="co">#&gt; 5       37 71536  4241  2859  2720  4414 53081 V5866</span></code></pre></div>
<p>In real life, there are often problems with the data, such as <code>NA</code> values, out-of-order <code>visit_id</code>s, non-existent or invalid ICD codes, etc.. Although standard R tools or the <code>tidyverse</code> can be used to clean the data, knowing the specific validation rules for ICD-9 and ICD-10 codes, as well as the standardized structure of healthcare data enables faster and more accurate data cleaning.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use AHRQ revision of Elixhauser comorbidities, show only first eight columns</span>
<span class="kw"><a href="../reference/comorbid.html">comorbid_ahrq</a></span>(patients_icd9)[, <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>]
<span class="co">#&gt;        CHF Valvular  PHTN   PVD   HTN Paralysis NeuroOther Pulmonary</span>
<span class="co">#&gt; 1000  TRUE    FALSE FALSE FALSE FALSE     FALSE      FALSE     FALSE</span>
<span class="co">#&gt; 1001 FALSE    FALSE FALSE FALSE  TRUE      TRUE      FALSE     FALSE</span>
<span class="co">#&gt; 1002 FALSE    FALSE FALSE FALSE  TRUE     FALSE      FALSE     FALSE</span></code></pre></div>
<p>Things work beautifully using <a href="https://cran.r-project.org/package=magrittr">magrittr</a> <code>%&gt;%</code> to chain functions together. <code>magrittr</code> is useful for chains of commands, such as the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find Elixhauser comorbidities which were present-on-arrival</span>
patients_icd9 <span class="op">%&gt;%</span><span class="st"> </span>filter_poa <span class="op">%&gt;%</span><span class="st"> </span>comorbid_elix
<span class="co">#&gt;        CHF Arrhythmia Valvular  PHTN   PVD   HTN Paralysis NeuroOther</span>
<span class="co">#&gt; 1000 FALSE      FALSE    FALSE FALSE FALSE FALSE     FALSE      FALSE</span>
<span class="co">#&gt; 1001 FALSE      FALSE    FALSE FALSE FALSE  TRUE     FALSE      FALSE</span>
<span class="co">#&gt;      Pulmonary    DM  DMcx Hypothyroid Renal Liver   PUD   HIV Lymphoma</span>
<span class="co">#&gt; 1000     FALSE  TRUE FALSE       FALSE FALSE FALSE FALSE FALSE    FALSE</span>
<span class="co">#&gt; 1001     FALSE FALSE FALSE       FALSE FALSE FALSE FALSE FALSE    FALSE</span>
<span class="co">#&gt;       Mets Tumor Rheumatic Coagulopathy Obesity WeightLoss FluidsLytes</span>
<span class="co">#&gt; 1000 FALSE FALSE     FALSE        FALSE   FALSE      FALSE       FALSE</span>
<span class="co">#&gt; 1001 FALSE FALSE     FALSE        FALSE   FALSE      FALSE       FALSE</span>
<span class="co">#&gt;      BloodLoss Anemia Alcohol Drugs Psychoses Depression</span>
<span class="co">#&gt; 1000     FALSE  FALSE   FALSE FALSE     FALSE      FALSE</span>
<span class="co">#&gt; 1001     FALSE  FALSE   FALSE FALSE     FALSE      FALSE</span>

<span class="co"># same as above, then summarize five columns:</span>
patients_icd9 <span class="op">%&gt;%</span>
<span class="st">  </span>filter_poa <span class="op">%&gt;%</span>
<span class="st">  </span>comorbid_elix <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">extract</span>(, <span class="dv">5</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>colSums
<span class="co">#&gt;        PVD        HTN  Paralysis NeuroOther  Pulmonary         DM </span>
<span class="co">#&gt;          0          1          0          0          0          1</span>

<span class="co"># convert vermont discharge data to wide format, </span>
<span class="co"># find comorbidities, convert TRUE to 1 and show first few</span>
vermont_cmb &lt;-<span class="st"> </span>vermont_dx <span class="op">%&gt;%</span><span class="st"> </span>wide_to_long <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>icd9_comorbid_quan_deyo <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">apply</span>(<span class="dv">2</span>, as.integer) <span class="co"># convert logical to integer</span>

<span class="kw">head</span>(vermont_cmb)
<span class="co">#&gt;      MI CHF PVD Stroke Dementia Pulmonary Rheumatic PUD LiverMild DM DMcx</span>
<span class="co">#&gt; [1,]  0   1   0      0        0         0         0   0         0  0    0</span>
<span class="co">#&gt; [2,]  0   1   0      0        0         1         0   0         0  1    0</span>
<span class="co">#&gt; [3,]  0   0   0      0        0         0         0   0         0  0    0</span>
<span class="co">#&gt; [4,]  0   0   0      0        0         1         0   0         0  0    0</span>
<span class="co">#&gt; [5,]  0   0   1      0        0         0         0   0         0  0    0</span>
<span class="co">#&gt; [6,]  0   0   0      0        0         0         0   0         0  0    0</span>
<span class="co">#&gt;      Paralysis Renal Cancer LiverSevere Mets HIV</span>
<span class="co">#&gt; [1,]         0     1      1           0    0   0</span>
<span class="co">#&gt; [2,]         0     0      0           0    0   0</span>
<span class="co">#&gt; [3,]         0     0      0           0    0   0</span>
<span class="co">#&gt; [4,]         0     0      0           0    0   0</span>
<span class="co">#&gt; [5,]         0     0      0           0    0   0</span>
<span class="co">#&gt; [6,]         0     0      0           0    0   0</span>

<span class="kw">barplot</span>(<span class="kw">colSums</span>(vermont_cmb[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]),
        <span class="dt">main =</span> <span class="st">"Histogram of Elixhauser Comorbidities in Vermont data"</span>)</code></pre></div>
<p><img src="introduction_files/figure-html/getcomorbidities2-1.png" width="700"></p>
<p>The above can be rewritten in classic R with many parentheses:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">apply</span>(<span class="kw"><a href="../reference/comorbid.html">icd9_comorbid_quan_deyo</a></span>(<span class="kw"><a href="../reference/wide_to_long.html">wide_to_long</a></span>(vermont_dx)), <span class="dv">2</span>, as.integer))</code></pre></div>
</div>
<div id="specifying-data-types" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-data-types" class="anchor"></a>Specifying data types</h2>
<p><code>icd</code> will guess the type and form of input data when possible, but there are sometimes ambiguities when ICD-9 and ICD-10 codes are mixed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/is_valid.html">is_valid</a></span>(<span class="st">"100"</span>) <span class="co"># valid ICD-9 code</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="kw"><a href="../reference/is_valid.html">is_valid</a></span>(<span class="st">"A1001"</span>) <span class="co"># valid ICD-10 code</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="kw"><a href="../reference/is_valid.html">is_valid</a></span>(<span class="kw">c</span>(<span class="st">"100"</span>, <span class="st">"A1001"</span>)) <span class="co"># they can't both be valid</span>
<span class="co">#&gt; [1]  TRUE FALSE</span></code></pre></div>
<p>You can let <code>icd</code> guess types, or specify the type of your data explicitly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># decimal format ICD-10 codes</span>
codes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"A10.01"</span>, <span class="st">"L40.50"</span>, <span class="st">"Z77.098"</span>)
<span class="co"># set class to be icd10cm (and implicitly icd10)</span>
<span class="kw"><a href="../reference/set_icd_class.html">as.icd10cm</a></span>(codes)
<span class="co">#&gt; [1] "A10.01"  "L40.50"  "Z77.098"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd10cm"   "icd10"     "character"</span>
<span class="co"># indicate decimal code and icd10 (not necessarily icd10cm)</span>
codes <span class="op">%&gt;%</span><span class="st"> </span>as.decimal_diag <span class="op">%&gt;%</span><span class="st"> </span>as.icd10
<span class="co">#&gt; [1] "A10.01"  "L40.50"  "Z77.098"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd10"     "character"</span></code></pre></div>
<p>Doing this avoids mistakes in guessing type. For example code <code>V10</code> is valid in both ICD-9 and ICD-10.</p>
</div>
<div id="converting-icd-codes-between-types" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-icd-codes-between-types" class="anchor"></a>Converting ICD codes between types</h2>
<p>ICD codes are usually presented in <em>decimal</em> format (beware, for this is not a number), e.g., the ICD-9 code <code>003.21</code>, or ICD-10 code <code>T81.10XD</code>, whereas most electronic records seem to use the <em>short</em> form without a decimal place. These are not interchangeable simply by removing the decimal place, and great care is taken to do this correctly. Most ICD-9 codes do not have a letter prefix, so there is possible ambiguity here. icd was designed to deal with the common problem of incorrectly formatted ICD codes. The assumption is made that short codes of three or fewer characters are describing only the ‘major’ part: there is no other reasonable interpretation. For example, <code>020</code> must be taken to mean <code>20</code>, not <code>2.0</code> or even <code>0.20</code>. In most cases, when <em>icd</em> works on ICD-9 codes, it will convert any codes of fewer than three characters into zero-padded three-digit codes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/decimal_to_short.html">decimal_to_short</a></span>(<span class="kw">c</span>(<span class="st">"1"</span>, <span class="st">"10.20"</span>, <span class="st">"100"</span>, <span class="st">"123.45"</span>))
<span class="co">#&gt; [1] "001"   "01020" "100"   "12345"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd9"      "character"</span>
<span class="kw"><a href="../reference/short_to_decimal.html">short_to_decimal</a></span>(<span class="kw">c</span>(<span class="st">"1"</span>, <span class="st">"22"</span>, <span class="st">"2244"</span>, <span class="st">"1005"</span>))
<span class="co">#&gt; [1] "001"   "022"   "224.4" "100.5"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd9"      "character"</span>

<span class="co"># similar operations with magrittr, also showing invalid codes</span>
codes &lt;-<span class="st"> </span><span class="kw"><a href="../reference/set_icd_class.html">as.icd9</a></span>(<span class="kw">c</span>(<span class="st">"87.65"</span>, <span class="st">"9999"</span>, <span class="st">"Aesop"</span>, <span class="dv">-100</span>, <span class="st">""</span>, <span class="ot">NA</span>))
<span class="kw"><a href="../reference/decimal_to_short.html">decimal_to_short</a></span>(codes)
<span class="co">#&gt; [1] "08765" ""      ""      ""      ""      NA     </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd9"      "character"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>

<span class="co"># ICD-10</span>
<span class="kw"><a href="../reference/decimal_to_short.html">decimal_to_short</a></span>(<span class="st">"T81.10XD"</span>)
<span class="co">#&gt; [1] "T8110XD"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd10"     "character"</span></code></pre></div>
</div>
<div id="validation-of-icd-9-codes" class="section level2">
<h2 class="hasAnchor">
<a href="#validation-of-icd-9-codes" class="anchor"></a>Validation of ICD-9 codes</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># guess both ICD version (9, but could be 10?), and decimal vs short form</span>
<span class="kw"><a href="../reference/is_valid.html">is_valid</a></span>(<span class="st">"V10.2"</span>)
<span class="co">#&gt; [1] TRUE</span>

<span class="co"># state we are using short or decimal codes:</span>
<span class="kw"><a href="../reference/is_valid.html">is_valid</a></span>(<span class="kw">c</span>(<span class="st">"099.17"</span>, <span class="st">"-1"</span>), <span class="dt">short_code =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] FALSE FALSE</span>
<span class="kw"><a href="../reference/is_valid.html">is_valid</a></span>(<span class="kw">c</span>(<span class="st">"099.17"</span>, <span class="st">"-1.1"</span>), <span class="dt">short_code =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1]  TRUE FALSE</span>
<span class="kw"><a href="../reference/is_valid.html">is_valid</a></span>(<span class="kw">c</span>(<span class="st">"1"</span>, <span class="st">"001"</span>, <span class="st">"100"</span>, <span class="st">"123456"</span>, <span class="st">"003.21"</span>), <span class="dt">short_code =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1]  TRUE  TRUE  TRUE FALSE FALSE</span></code></pre></div>
</div>
<div id="decoding-icd-9-codes-to-descriptions" class="section level2">
<h2 class="hasAnchor">
<a href="#decoding-icd-9-codes-to-descriptions" class="anchor"></a>Decoding ICD-9 codes to descriptions</h2>
<p>There are various ways of extracting the description of the condition described by an ICD-9 code. the explain group of functions return a data frame with a column for the ICD-9 code, a column for the full length Diagnosis, and a column for the short Description.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="st">"1.0"</span>) <span class="co"># 'decimal' format code inferred</span>
<span class="co">#&gt; [1] "Cholera due to vibrio cholerae"</span>
<span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="st">"0019"</span>) <span class="co"># 'short' format code inferred</span>
<span class="co">#&gt; [1] "Cholera, unspecified"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we can be explicit about short vs decimal</span>
<span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="st">"434.00"</span>, <span class="dt">short_code =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] "Cerebral thrombosis without mention of cerebral infarction"</span>
<span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="kw">c</span>(<span class="st">"43410"</span>, <span class="st">"43491"</span>), <span class="dt">short_code =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] "Cerebral embolism without mention of cerebral infarction"       </span>
<span class="co">#&gt; [2] "Cerebral artery occlusion, unspecified with cerebral infarction"</span>
<span class="co">#explain top level code with children</span>
<span class="st">"391"</span> <span class="op">%&gt;%</span><span class="st"> </span>explain <span class="co"># single three-digit code</span>
<span class="co">#&gt; [1] "Rheumatic fever with heart involvement"</span>
<span class="st">"391"</span> <span class="op">%&gt;%</span><span class="st"> </span>children <span class="co"># let's see the child codes</span>
<span class="co">#&gt; [1] "391"  "3910" "3911" "3912" "3918" "3919"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd9"      "character"</span>
<span class="st">"391"</span> <span class="op">%&gt;%</span><span class="st"> </span>children <span class="op">%&gt;%</span><span class="st"> </span>explain <span class="co"># children condensed to parent code</span>
<span class="co">#&gt; [1] "Rheumatic fever with heart involvement"</span>
<span class="st">"391"</span> <span class="op">%&gt;%</span><span class="st"> </span>children <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">condense =</span> <span class="ot">FALSE</span>) <span class="co"># prevent condense</span>
<span class="co">#&gt; [1] "Rheumatic fever with heart involvement"    </span>
<span class="co">#&gt; [2] "Acute rheumatic pericarditis"              </span>
<span class="co">#&gt; [3] "Acute rheumatic endocarditis"              </span>
<span class="co">#&gt; [4] "Acute rheumatic myocarditis"               </span>
<span class="co">#&gt; [5] "Other acute rheumatic heart disease"       </span>
<span class="co">#&gt; [6] "Acute rheumatic heart disease, unspecified"</span></code></pre></div>
<p>Arbitrary named list(s) of codes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="kw">list</span>(<span class="dt">somecodes =</span> <span class="kw"><a href="../reference/set_icd_class.html">as.icd9</a></span>(<span class="kw">c</span>(<span class="st">"001"</span>, <span class="st">"391"</span>)),
                 <span class="dt">morecodes =</span> <span class="kw"><a href="../reference/set_icd_class.html">as.icd9cm</a></span>(<span class="kw">c</span>(<span class="st">"001.1"</span>, <span class="st">"001.9"</span>))))
<span class="co">#&gt; $somecodes</span>
<span class="co">#&gt; [1] "Cholera"                               </span>
<span class="co">#&gt; [2] "Rheumatic fever with heart involvement"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $morecodes</span>
<span class="co">#&gt; [1] "Cholera due to vibrio cholerae el tor"</span>
<span class="co">#&gt; [2] "Cholera, unspecified"</span></code></pre></div>
<p><code>001</code> (Cholera) isn’t itself a diagnostic code, i.e. leaf node in the hierarchy, but <code>390</code> (Rheumatic fever without heart involvement) is. Both are explained correctly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="kw">list</span>(<span class="dt">cholera =</span> <span class="st">"001"</span>, <span class="dt">rheumatic_heart =</span> <span class="st">"390"</span>))
<span class="co">#&gt; $cholera</span>
<span class="co">#&gt; [1] "Cholera"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $rheumatic_heart</span>
<span class="co">#&gt; [1] "Rheumatic fever without mention of heart involvement"</span></code></pre></div>
<p>Now try to explain on a non-existent (but ‘valid’) ICD-9 code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="st">"001.5"</span>) <span class="co"># gives warning</span></code></pre></div>
<p>As we have just seen, <em>explain</em> can convert lists of ICD-9 or ICD-10 codes to a human-readable format. Let’s apply the <code>explain</code> to a list of comorbidity ICD-9 codes in one of the commonly-used mappings. This makes comprehending a complicated list much easier. Taking the list for dementia:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(icd9_map_quan_deyo[[<span class="st">"Dementia"</span>]]) <span class="co"># 133 possible ICD-9 codes</span>
<span class="co">#&gt; [1] 133</span>
<span class="kw">length</span>(icd10_map_quan_deyo[[<span class="st">"Dementia"</span>]]) <span class="co"># the ICD-10 map is different</span>
<span class="co">#&gt; [1] 20</span>
<span class="co"># explain summarizes these to just two groups:</span>
icd9_map_quan_deyo[[<span class="st">"Dementia"</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">warn =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] "Dementias"                                  </span>
<span class="co">#&gt; [2] "Dementia in conditions classified elsewhere"</span>
<span class="co">#&gt; [3] "Senile degeneration of brain"</span>
<span class="co"># contrast with:</span>
icd9_map_quan_deyo[[<span class="st">"Dementia"</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">condense =</span> <span class="ot">TRUE</span>, <span class="dt">warn =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] "Dementias"                                  </span>
<span class="co">#&gt; [2] "Dementia in conditions classified elsewhere"</span>
<span class="co">#&gt; [3] "Senile degeneration of brain"</span></code></pre></div>
<p>Use a range with more than two hundred ICD-9 codes (most of them not real):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(<span class="st">"390"</span> <span class="op">%i9da%</span><span class="st"> "392.1"</span>)
<span class="co">#&gt; [1] 244</span>
<span class="st">"390"</span> <span class="op">%i9da%</span><span class="st"> "392.1"</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">warn =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] "Rheumatic fever without mention of heart involvement"</span>
<span class="co">#&gt; [2] "Rheumatic fever with heart involvement"              </span>
<span class="co">#&gt; [3] "Rheumatic chorea with heart involvement"</span></code></pre></div>
<p>The warnings here are irrelevant because we know that `%i9da% produces codes which do not correspond to diagnoses. However, in other usage, the user would typically expect the ICD-9 codes he or she is using to be diagnostic, hence the default to warn.</p>
</div>
<div id="filtering-by-present-on-arrival" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-by-present-on-arrival" class="anchor"></a>Filtering by Present-on-Arrival</h2>
<p>This flag is recorded with each ICD-9 code, indicating whether that diagnosis was present on admission. With some caution, codes flagged specifically not <em>POA</em> can be treated as new diseases during an admission.</p>
<p>Present-on-arrival (POA) is typically a factor, or vector of values such as “Y”, “N”, “X”, “E”, or NA. Intermediate codes, such as “exempt”, “unknown” and NA mean that “yes” is not the same as “not no.” This requires four functions to cover the possibilities stored in <code>poa_choices</code>:</p>
<pre><code>#&gt; [1] "yes"    "no"     "notYes" "notNo"</code></pre>
<p>Filter for present-on-arrival being “Y”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patients_icd9 <span class="op">%&gt;%</span><span class="st"> </span>filter_poa_yes
<span class="co">#&gt;   visit_id  icd9</span>
<span class="co">#&gt; 1     1000 40201</span>
<span class="co">#&gt; 4     1000 25001</span>
<span class="co">#&gt; 6     1001  4011</span></code></pre></div>
<p>Show that <em>yes</em> is not equal to <em>not no</em> (e.g. due to NA in <code>poa</code> field)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patients_icd9 <span class="op">%&gt;%</span><span class="st"> </span>filter_poa_not_no
<span class="co">#&gt;   visit_id  icd9</span>
<span class="co">#&gt; 1     1000 40201</span>
<span class="co">#&gt; 2     1000  2258</span>
<span class="co">#&gt; 4     1000 25001</span>
<span class="co">#&gt; 5     1001 34400</span>
<span class="co">#&gt; 6     1001  4011</span>
<span class="co">#&gt; 7     1002  4011</span></code></pre></div>
</div>
<div id="comorbidities" class="section level2">
<h2 class="hasAnchor">
<a href="#comorbidities" class="anchor"></a>Comorbidities</h2>
<p>The comorbidities from different sources are provided as lists. At present only the most recent mapping of ICD-9 codes to comorbidities is provided. See these <a href="https://github.com/jackwasey/icd/issues/6">github</a> <a href="https://github.com/jackwasey/icd/issues/7">issues</a>.</p>
<p>This package contains ICD-9-CM to comorbidity mappings from several sources, based on either the Charlson or Elixhauser lists of comorbidities. Updated versions of these lists from <a href="http://www.hcup-us.ahrq.gov/toolssoftware/comorbidity/comorbidity.jsp">AHRQ</a> and <a href="http://www.ncbi.nlm.nih.gov/pubmed/16224307">Quan et al</a> are included, along with the original Elixhauser mapping . Since some data is provided in SAS source code format, this package has internal functions to parse this SAS source code and generate R data structures. This processing is limited to what is needed for this purpose, although may be generalizable and useful in other contexts. Other lists are transcribed directly from the published articles, but interpretation of SAS code used for the original publications is preferable.</p>
<div id="ahrq-comorbidity-classification" class="section level3">
<h3 class="hasAnchor">
<a href="#ahrq-comorbidity-classification" class="anchor"></a>AHRQ comorbidity classification</h3>
<p>The AHRQ keeps an updated version of the Elixhauser classification of ICD-9-CM codes into comorbidities, useful for research. They provide the data in the form of SAS code. The names of the comorbidities derived from ICD-9 and ICD-10 codes are the same. Maps contain the ICD code to comorbidity mappings; the functions that apply those mappings are called things like <code>icd10_comorbid_ahrq</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#icd9_map_ahrq &lt;- icd:::sas_parse_ahrq() # user doesn't need to do this</span>
<span class="kw">names</span>(icd9_map_ahrq)
<span class="co">#&gt;  [1] "CHF"          "Valvular"     "PHTN"         "PVD"         </span>
<span class="co">#&gt;  [5] "HTN"          "HTNcx"        "Paralysis"    "NeuroOther"  </span>
<span class="co">#&gt;  [9] "Pulmonary"    "DM"           "DMcx"         "Hypothyroid" </span>
<span class="co">#&gt; [13] "Renal"        "Liver"        "PUD"          "HIV"         </span>
<span class="co">#&gt; [17] "Lymphoma"     "Mets"         "Tumor"        "Rheumatic"   </span>
<span class="co">#&gt; [21] "Coagulopathy" "Obesity"      "WeightLoss"   "FluidsLytes" </span>
<span class="co">#&gt; [25] "BloodLoss"    "Anemia"       "Alcohol"      "Drugs"       </span>
<span class="co">#&gt; [29] "Psychoses"    "Depression"</span>
icd9_map_ahrq<span class="op">$</span>CHF[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt; [1] "39891" "40201" "40211" "40291" "40401"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd9"      "character"</span>
icd10_map_ahrq<span class="op">$</span>CHF[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt; [1] "I0981" "I501"  "I5020" "I5021" "I5022"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd10"     "character"</span></code></pre></div>
</div>
<div id="elixhauser-comorbidities" class="section level3">
<h3 class="hasAnchor">
<a href="#elixhauser-comorbidities" class="anchor"></a>Elixhauser comorbidities</h3>
<p>Elixhauser originally devleoped this set of comorbidities to predict long term mortality based on hospital ICD-9-CM coding records. The AHRQ comorbidities are an updated version of this, however the original Elixhauser have been used in many publications. The ICD-9-CM codes have changed slightly over the years.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the names of the comorbidities in each map are available as named lists:</span>
names_elix[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt; $`01`</span>
<span class="co">#&gt; [1] "Congestive heart failure"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`02`</span>
<span class="co">#&gt; [1] "Cardiac arrhythmias"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`03`</span>
<span class="co">#&gt; [1] "Valvular disease"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`04`</span>
<span class="co">#&gt; [1] "Pulmonary circulation disorders"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`05`</span>
<span class="co">#&gt; [1] "Peripheral vascular disorders"</span>
<span class="kw">unlist</span>(<span class="kw">unname</span>(names_elix))
<span class="co">#&gt;  [1] "Congestive heart failure"                       </span>
<span class="co">#&gt;  [2] "Cardiac arrhythmias"                            </span>
<span class="co">#&gt;  [3] "Valvular disease"                               </span>
<span class="co">#&gt;  [4] "Pulmonary circulation disorders"                </span>
<span class="co">#&gt;  [5] "Peripheral vascular disorders"                  </span>
<span class="co">#&gt;  [6] "Hypertension, combined"                         </span>
<span class="co">#&gt;  [7] "Paralysis"                                      </span>
<span class="co">#&gt;  [8] "Other neurological disorders"                   </span>
<span class="co">#&gt;  [9] "Chronic pulmonary disease"                      </span>
<span class="co">#&gt; [10] "Diabetes, uncomplicated"                        </span>
<span class="co">#&gt; [11] "Diabetes, complicated"                          </span>
<span class="co">#&gt; [12] "Hypothyroidism"                                 </span>
<span class="co">#&gt; [13] "Renal failure"                                  </span>
<span class="co">#&gt; [14] "Liver disease"                                  </span>
<span class="co">#&gt; [15] "Peptic ulcer disease excluding bleeding"        </span>
<span class="co">#&gt; [16] "HIV/AIDS"                                       </span>
<span class="co">#&gt; [17] "Lymphoma"                                       </span>
<span class="co">#&gt; [18] "Metastatic cancer"                              </span>
<span class="co">#&gt; [19] "Solid tumor without metastasis"                 </span>
<span class="co">#&gt; [20] "Rheumatoid arthritis/collagen vascular diseases"</span>
<span class="co">#&gt; [21] "Coagulopathy"                                   </span>
<span class="co">#&gt; [22] "Obesity"                                        </span>
<span class="co">#&gt; [23] "Weight loss"                                    </span>
<span class="co">#&gt; [24] "Fluid and electrolye disorders"                 </span>
<span class="co">#&gt; [25] "Blood loss anemia"                              </span>
<span class="co">#&gt; [26] "Deficiency anemias"                             </span>
<span class="co">#&gt; [27] "Alcohol abuse"                                  </span>
<span class="co">#&gt; [28] "Drug abuse"                                     </span>
<span class="co">#&gt; [29] "Psychoses"                                      </span>
<span class="co">#&gt; [30] "Depression"</span>
<span class="co"># The map contents have ICD codes with the class set</span>
icd9_map_elix<span class="op">$</span>HTNcx
<span class="co">#&gt; [1] "40210" "40290" "40410" "40490" "40511" "40519" "40591" "40599"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd9"      "character"</span>
icd10_map_elix<span class="op">$</span>HTNcx
<span class="co">#&gt; [1] "I11" "I12" "I13" "I15"</span>
<span class="co">#&gt; attr(,"icd_short_diag")</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "icd10"     "character"</span></code></pre></div>
</div>
<div id="quan" class="section level3">
<h3 class="hasAnchor">
<a href="#quan" class="anchor"></a>Quan</h3>
<p>Quan’s paper looked at indices using both ICD-10 and ICD-9-CM. Quan generated updated ICD-9-CM codes for all 30 of Elixhauser and all 17 of Charlson/Deyo’s comorbidities. Thus there are two ‘Quan’ comorbidity mappings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(icd10_map_quan_deyo)
<span class="co">#&gt;  [1] "MI"          "CHF"         "PVD"         "Stroke"      "Dementia"   </span>
<span class="co">#&gt;  [6] "Pulmonary"   "Rheumatic"   "PUD"         "LiverMild"   "DM"         </span>
<span class="co">#&gt; [11] "DMcx"        "Paralysis"   "Renal"       "Cancer"      "LiverSevere"</span>
<span class="co">#&gt; [16] "Mets"        "HIV"</span>
<span class="kw">names</span>(icd10_map_quan_elix)
<span class="co">#&gt;  [1] "CHF"          "Arrhythmia"   "Valvular"     "PHTN"        </span>
<span class="co">#&gt;  [5] "PVD"          "HTN"          "HTNcx"        "Paralysis"   </span>
<span class="co">#&gt;  [9] "NeuroOther"   "Pulmonary"    "DM"           "DMcx"        </span>
<span class="co">#&gt; [13] "Hypothyroid"  "Renal"        "Liver"        "PUD"         </span>
<span class="co">#&gt; [17] "HIV"          "Lymphoma"     "Mets"         "Tumor"       </span>
<span class="co">#&gt; [21] "Rheumatic"    "Coagulopathy" "Obesity"      "WeightLoss"  </span>
<span class="co">#&gt; [25] "FluidsLytes"  "BloodLoss"    "Anemia"       "Alcohol"     </span>
<span class="co">#&gt; [29] "Drugs"        "Psychoses"    "Depression"</span></code></pre></div>
</div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="filter-patients-and-create-comorbidities" class="section level3">
<h3 class="hasAnchor">
<a href="#filter-patients-and-create-comorbidities" class="anchor"></a>Filter patients and create comorbidities</h3>
<p>Take my patients, find the ones where there definitely or maybe was a diagnosis present on admission, then generate comorbidities based on the AHRQ mapping. N.b. <code>NotNo</code> is not the same as <code>Yes</code> because of some exempt, unclassifiable conditions, or <code>NA</code> values for the present-on-admission flag.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patients_icd9 <span class="op">%&gt;%</span>
<span class="st">  </span>filter_poa_not_no <span class="op">%&gt;%</span>
<span class="st">  </span>icd9_comorbid_ahrq <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">extract</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)
<span class="co">#&gt; [1]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></code></pre></div>
</div>
<div id="compare-two-comorbidity-definitions" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-two-comorbidity-definitions" class="anchor"></a>Compare two comorbidity definitions</h3>
<p>We will find the differences between some categories of the original Elixhauser and the updated version by Quan. Just taking the select few comorbidity groups for brevity:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">difference &lt;-<span class="st"> </span><span class="kw"><a href="../reference/diff_comorbid.html">diff_comorbid</a></span>(icd9_map_elix, icd9_map_quan_elix,
                            <span class="dt">all_names =</span> <span class="kw">c</span>(<span class="st">"CHF"</span>, <span class="st">"PHTN"</span>, <span class="st">"HTN"</span>, <span class="st">"Valvular"</span>))
<span class="co">#&gt; Comorbidity CHF: </span>
<span class="co">#&gt; icd9_map_quan_elix has 70 codes not in icd9_map_elix. First few are: 'Heart failure' 'Mal hypert hrt dis w hf' 'Mal hyp ht/kd I-IV w hf' 'Mal hyp ht/kd stg V w hf' 'Prim cardiomyopathy NEC' </span>
<span class="co">#&gt; Comorbidity PHTN: </span>
<span class="co">#&gt; icd9_map_quan_elix has 45 codes not in icd9_map_elix. First few are: 'Acute pulmonary heart disease' 'Chronic pulmonary heart disease' 'Arterioven fistu pul ves' 'Pulmon circulat dis NEC' </span>
<span class="co">#&gt; Comorbidity HTN: </span>
<span class="co">#&gt; icd9_map_quan_elix has 89 codes not in icd9_map_elix. First few are: 'Essential hypertension' </span>
<span class="co">#&gt; Comorbidity Valvular: </span>
<span class="co">#&gt; icd9_map_quan_elix has 106 codes not in icd9_map_elix. First few are: 'Diseases of mitral valve' 'Diseases of other endocardial structures' 'Other diseases of endocardium' 'Syphilitic endocarditis'</span>
<span class="co"># reuslts also returned as data</span>
<span class="kw">str</span>(difference)
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ CHF     :List of 3</span>
<span class="co">#&gt;   ..$ both  : chr [1:117] "39891" "40211" "40291" "40411" ...</span>
<span class="co">#&gt;   ..$ only.x: chr(0) </span>
<span class="co">#&gt;   ..$ only.y: chr [1:70] "40201" "40401" "40403" "4254" ...</span>
<span class="co">#&gt;  $ PHTN    :List of 3</span>
<span class="co">#&gt;   ..$ both  : chr [1:121] "4160" "41600" "41601" "41602" ...</span>
<span class="co">#&gt;   ..$ only.x: chr(0) </span>
<span class="co">#&gt;   ..$ only.y: chr [1:45] "4150" "41500" "41501" "41502" ...</span>
<span class="co">#&gt;  $ HTN     :List of 3</span>
<span class="co">#&gt;   ..$ both  : chr [1:22] "4011" "40110" "40111" "40112" ...</span>
<span class="co">#&gt;   ..$ only.x: chr(0) </span>
<span class="co">#&gt;   ..$ only.y: chr [1:89] "401" "4010" "40100" "40101" ...</span>
<span class="co">#&gt;  $ Valvular:List of 3</span>
<span class="co">#&gt;   ..$ both  : chr [1:526] "09320" "09321" "09322" "09323" ...</span>
<span class="co">#&gt;   ..$ only.x: chr(0) </span>
<span class="co">#&gt;   ..$ only.y: chr [1:106] "0932" "09325" "09326" "09327" ...</span></code></pre></div>
<p>Which pulmonary hypertension codes are only in Quan’s version?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">difference<span class="op">$</span>PHTN<span class="op">$</span>only.y <span class="op">%&gt;%</span><span class="st"> </span>get_defined <span class="op">%&gt;%</span><span class="st"> </span>explain
<span class="co">#&gt; [1] "Acute pulmonary heart disease"                    </span>
<span class="co">#&gt; [2] "Chronic pulmonary heart disease"                  </span>
<span class="co">#&gt; [3] "Arteriovenous fistula of pulmonary vessels"       </span>
<span class="co">#&gt; [4] "Other specified diseases of pulmonary circulation"</span></code></pre></div>
<p>(Passing through <code>get_defined</code> stops <code>explain</code> complaining that some of the input codes don’t exist. This is because the comorbidity mappings have every possible numerical ICD-9 code, not just the official ones. Could also use <code>warn = FALSE</code> option in <code>explain</code>)</p>
</div>
<div id="find-cardiac-icd-9-codes" class="section level3">
<h3 class="hasAnchor">
<a href="#find-cardiac-icd-9-codes" class="anchor"></a>Find cardiac ICD-9 codes</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">icd9cm_hierarchy[
  <span class="kw">grepl</span>(<span class="dt">pattern =</span> <span class="st">"(heart)|(cardiac)"</span>,
        <span class="dt">x =</span> <span class="kw">c</span>(icd9cm_hierarchy<span class="op">$</span>long_desc, icd9cm_hierarchy<span class="op">$</span>short_desc),
        <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>),
  <span class="st">"code"</span>] <span class="op">%&gt;%</span><span class="st"> </span>unique -&gt;<span class="st"> </span>cardiac</code></pre></div>
<p>then explain the list, just showing the first ten:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/set_icd_class.html">as.icd9</a></span>(cardiac) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(<span class="dt">warn =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">10</span>)
<span class="co">#&gt;  [1] "Malignant neoplasm of thymus, heart, and mediastinum"    </span>
<span class="co">#&gt;  [2] "Rheumatic fever without mention of heart involvement"    </span>
<span class="co">#&gt;  [3] "Rheumatic fever with heart involvement"                  </span>
<span class="co">#&gt;  [4] "Rheumatic chorea"                                        </span>
<span class="co">#&gt;  [5] "Other rheumatic heart disease"                           </span>
<span class="co">#&gt;  [6] "Hypertensive heart disease"                              </span>
<span class="co">#&gt;  [7] "Hypertensive heart and chronic kidney disease"           </span>
<span class="co">#&gt;  [8] "Other acute and subacute forms of ischemic heart disease"</span>
<span class="co">#&gt;  [9] "Other forms of chronic ischemic heart disease"           </span>
<span class="co">#&gt; [10] "Acute pulmonary heart disease"</span></code></pre></div>
</div>
<div id="find-comorbidities-for-a-large-number-of-patients" class="section level3">
<h3 class="hasAnchor">
<a href="#find-comorbidities-for-a-large-number-of-patients" class="anchor"></a>Find comorbidities for a large number of patients</h3>
<p>I understand that comorbiditity assignment using SAS is a lengthy business. Let’s generate 100,000 patients with a random selection of comorbidities:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># codes selected from AHRQ mapping</span>
many_patients &lt;-<span class="st"> </span>icd<span class="op">:::</span><span class="kw"><a href="../reference/generate_random_short_icd9.html">generate_random_pts</a></span>(<span class="fl">1e7</span>)
<span class="kw">system.time</span>(
  <span class="kw"><a href="../reference/comorbid.html">comorbid_ahrq</a></span>(many_patients)
  )[[<span class="st">"elapsed"</span>]] </code></pre></div>
<p>This takes about five seconds on a 2016 8-core workstation. More detailed benchmarks can be seen comparing icd to other packages in the vignette article in this package.</p>
</div>
<div id="use-an-arbitrary-icd-9-mapping" class="section level3">
<h3 class="hasAnchor">
<a href="#use-an-arbitrary-icd-9-mapping" class="anchor"></a>Use an arbitrary ICD-9 mapping</h3>
<p>The user can provide any ICD-9, ICD-10 or other code mapping to comorbidities they wish. Submissions of other peer-reviewed published mappings could be included in this package, if their license permits. Create an issue in <a href="https://github.com/jackwasey/icd/issues">github</a> or email me at <a href="mailto:jack@jackwasey.com">jack@jackwasey.com</a>) Included in this package is a small data set called <code>icd9_chapters</code>, which lists the ICD-9-CM (and indeed ICD-9) Chapters. These can easily be expanded out and used as a mapping, so instead of a comorbidity, we see which patients have codes in each chapter of the ICD-9 defintion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(icd9_chapters)[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">14</span>)]
<span class="co">#&gt; [1] "Infectious And Parasitic Diseases"                                    </span>
<span class="co">#&gt; [2] "Neoplasms"                                                            </span>
<span class="co">#&gt; [3] "Endocrine, Nutritional And Metabolic Diseases, And Immunity Disorders"</span>
<span class="co">#&gt; [4] "Diseases Of The Blood And Blood-Forming Organs"                       </span>
<span class="co">#&gt; [5] "Mental Disorders"                                                     </span>
<span class="co">#&gt; [6] "Congenital Anomalies"</span>
my_map &lt;-<span class="st"> </span>icd<span class="op">:::</span><span class="kw"><a href="../reference/icd9_chapters_to_map.html">icd9_chapters_to_map</a></span>(icd9_chapters[<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">14</span>)])
<span class="kw"><a href="../reference/comorbid.html">icd9_comorbid</a></span>(patients_icd9, my_map) <span class="co"># no positive </span>
<span class="co">#&gt;      Neoplasms Mental Disorders Congenital Anomalies</span>
<span class="co">#&gt; 1000      TRUE            FALSE                FALSE</span>
<span class="co">#&gt; 1001     FALSE            FALSE                FALSE</span>
<span class="co">#&gt; 1002     FALSE            FALSE                FALSE</span></code></pre></div>
</div>
<div id="reduce-comorbidity-mapping-from-possible-values-to-defined-diagnostic-codes" class="section level3">
<h3 class="hasAnchor">
<a href="#reduce-comorbidity-mapping-from-possible-values-to-defined-diagnostic-codes" class="anchor"></a>Reduce comorbidity mapping from possible values to defined diagnostic codes</h3>
<p>Suppose we want to exact match only real ICD-9 codes when looking up comorbdities for some patients. E.g. if the coder accidentally omitted a trailing zero, e.g. code <code>003.20</code> (<em>Localized salmonella infection, unspecified</em>) might have been written as <code>003.2</code> which has a heading (<em>Localized salmonella infections</em>) but is not itself billable. Use of ICD-9 codes for comorbidities generally assumes the codes are either right or wrong. How do we match only real codes, for a strict interpretation of comorbidities? It’s one line or R code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ahrq_strict &lt;-<span class="st"> </span><span class="kw">lapply</span>(icd9_map_ahrq, get_defined)
<span class="kw">str</span>(icd9_map_ahrq[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]) <span class="co"># first five of the original:</span>
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ CHF     :Classes 'icd9', 'character'  atomic [1:121] 39891 40201 40211 40291 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ Valvular:Classes 'icd9', 'character'  atomic [1:554] 0932 09320 09321 09322 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ PHTN    :Classes 'icd9', 'character'  atomic [1:133] 4151 41510 41511 41512 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ PVD     :Classes 'icd9', 'character'  atomic [1:598] 440 4400 44000 44001 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ HTN     :Classes 'icd9', 'character'  atomic [1:33] 4011 40110 40111 40112 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="kw">str</span>(icd9_map_ahrq[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]) <span class="co"># and first five of the result:</span>
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ CHF     :Classes 'icd9', 'character'  atomic [1:121] 39891 40201 40211 40291 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ Valvular:Classes 'icd9', 'character'  atomic [1:554] 0932 09320 09321 09322 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ PHTN    :Classes 'icd9', 'character'  atomic [1:133] 4151 41510 41511 41512 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ PVD     :Classes 'icd9', 'character'  atomic [1:598] 440 4400 44000 44001 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span>
<span class="co">#&gt;  $ HTN     :Classes 'icd9', 'character'  atomic [1:33] 4011 40110 40111 40112 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "icd_short_diag")= logi TRUE</span></code></pre></div>
<p>Note the much smaller numbers of codes in each group, now we have discarded all the ones which are not defined as diagnoses.</p>
</div>
<div id="which-three-character-icd-9-codes-have-no-child-codes" class="section level3">
<h3 class="hasAnchor">
<a href="#which-three-character-icd-9-codes-have-no-child-codes" class="anchor"></a>Which three-character ICD-9 codes have no child codes</h3>
<p>The ICD-9-CM scheme is structured as follows: - Chapter - Sub-chapter - Major part (three-digit codes) - sub-division (first decimal place) - sub-sub-division (second decimal place)</p>
<p>For most combinations of zero to nine, nothing is defined. Sometimes, nodes at one level in the hierarchy are descriptive only of their children (branch nodes), whereas some are themselves billable. For this example, let’s find those numeric-only codes which have no children, and by implication are themselves directly billable codes. Here are the first ten:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">icd9cm_hierarchy<span class="op">$</span>code <span class="op">%&gt;%</span><span class="st"> </span>get_defined -&gt;<span class="st"> </span>all_real
<span class="co"># select the non-V and non-E codes</span>
three_digit_real &lt;-<span class="st"> </span>all_real[<span class="kw"><a href="../reference/icd9_is_n.html">icd9_is_n</a></span>(all_real)]
<span class="co"># display</span>
three_digit_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">code =</span> three_digit_real, <span class="dt">description =</span> <span class="kw"><a href="../reference/explain.html">explain</a></span>(three_digit_real, <span class="dt">condense =</span> <span class="ot">FALSE</span>))
<span class="kw">print</span>(three_digit_df[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ], <span class="dt">row.names =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt;  code                                  description</span>
<span class="co">#&gt;   001                                      Cholera</span>
<span class="co">#&gt;  0010               Typhoid and paratyphoid fevers</span>
<span class="co">#&gt;  0011                  Other salmonella infections</span>
<span class="co">#&gt;  0019                                  Shigellosis</span>
<span class="co">#&gt;   002             Other food poisoning (bacterial)</span>
<span class="co">#&gt;  0020                                    Amebiasis</span>
<span class="co">#&gt;  0021          Other protozoal intestinal diseases</span>
<span class="co">#&gt;  0022 Intestinal infections due to other organisms</span>
<span class="co">#&gt;  0023            Ill-defined intestinal infections</span>
<span class="co">#&gt;  0029                Primary tuberculous infection</span></code></pre></div>
</div>
<div id="which-icd-9-codes-have-changed-between-versions-of-icd-9" class="section level3">
<h3 class="hasAnchor">
<a href="#which-icd-9-codes-have-changed-between-versions-of-icd-9" class="anchor"></a>Which ICD-9 codes have changed between versions of ICD-9</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_since_<span class="dv">27</span> &lt;-<span class="st"> </span><span class="kw">setdiff</span>(icd9cm_billable[[<span class="st">"32"</span>]][[<span class="st">"code"</span>]],
                         icd9cm_billable[[<span class="st">"27"</span>]][[<span class="st">"code"</span>]]) <span class="op">%&gt;%</span><span class="st"> </span>head
lost_since_<span class="dv">27</span> &lt;-<span class="st"> </span><span class="kw">setdiff</span>(icd9cm_billable[[<span class="st">"27"</span>]][[<span class="st">"code"</span>]],
                         icd9cm_billable[[<span class="st">"32"</span>]][[<span class="st">"code"</span>]]) <span class="op">%&gt;%</span><span class="st"> </span>tail
<span class="co"># we know this is an ICD-9-CM code, so declare this using nice magrittr motif:</span>
lost_since_<span class="dv">27</span> <span class="op">%&lt;&gt;%</span><span class="st"> </span>as.icd9cm
lost_since_<span class="dv">27</span> <span class="op">%&lt;&gt;%</span><span class="st"> </span>as.icd9cm

<span class="co"># these are a few which were gained since v27</span>
<span class="kw">data.frame</span>(<span class="dt">code =</span> new_since_<span class="dv">27</span>, <span class="dt">desc =</span> new_since_<span class="dv">27</span> <span class="op">%&gt;%</span><span class="st"> </span>explain)
<span class="co">#&gt;    code                                          desc</span>
<span class="co">#&gt; 1 04141                     Escherichia coli [E.coli]</span>
<span class="co">#&gt; 2 04142 Unspecified malignant neoplasm of skin of lip</span>
<span class="co">#&gt; 3 04143           Basal cell carcinoma of skin of lip</span>
<span class="co">#&gt; 4 04149                     Escherichia coli [E.coli]</span>
<span class="co">#&gt; 5 17300 Unspecified malignant neoplasm of skin of lip</span>
<span class="co">#&gt; 6 17301           Basal cell carcinoma of skin of lip</span>
<span class="co"># these are a few which were lost since v27</span>
<span class="kw">data.frame</span>(<span class="dt">code =</span> lost_since_<span class="dv">27</span>, <span class="dt">desc =</span> lost_since_<span class="dv">27</span> <span class="op">%&gt;%</span><span class="st"> </span>explain)
<span class="co">#&gt;   code</span>
<span class="co">#&gt; 1 V122</span>
<span class="co">#&gt; 2 V138</span>
<span class="co">#&gt; 3 V191</span>
<span class="co">#&gt; 4 V251</span>
<span class="co">#&gt; 5 V403</span>
<span class="co">#&gt; 6 V854</span>
<span class="co">#&gt;                                                                      desc</span>
<span class="co">#&gt; 1                            Endocrine, metabolic, and immunity disorders</span>
<span class="co">#&gt; 2                                                Other specified diseases</span>
<span class="co">#&gt; 3                                                     Other eye disorders</span>
<span class="co">#&gt; 4 Encounter for insertion or removal of intrauterine contraceptive device</span>
<span class="co">#&gt; 5                                               Other behavioral problems</span>
<span class="co">#&gt; 6                                      Body Mass Index 40 and over, adult</span></code></pre></div>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>This package allows fluid, fast and accurate manipulation of ICD-9 and ICD-10 codes, especially when combined with <a href="https://cran.r-project.org/package=magrittr">magrittr</a>. Suggestions, contributions and comments are welcome via <a href="https://github.com/jackwasey/icd/issues">github</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#quick-start">Quick Start</a></li>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#specifying-data-types">Specifying data types</a></li>
      <li><a href="#converting-icd-codes-between-types">Converting ICD codes between types</a></li>
      <li><a href="#validation-of-icd-9-codes">Validation of ICD-9 codes</a></li>
      <li><a href="#decoding-icd-9-codes-to-descriptions">Decoding ICD-9 codes to descriptions</a></li>
      <li><a href="#filtering-by-present-on-arrival">Filtering by Present-on-Arrival</a></li>
      <li><a href="#comorbidities">Comorbidities</a></li>
      <li><a href="#examples">Examples</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jack O. Wasey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
